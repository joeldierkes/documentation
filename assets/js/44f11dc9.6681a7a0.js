(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{151:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return a})),n.d(t,"default",(function(){return d}));var r=n(3),o=n(7),b=(n(0),n(412)),l=["components"],c={title:"BaseClient"},i={unversionedId:"client_api/baseclient",id:"client_api/baseclient",isDocsHomePage:!1,title:"BaseClient",description:"choice",source:"@site/../docs/client_api/baseclient.md",sourceDirName:"client_api",slug:"/client_api/baseclient",permalink:"/documentation/client_api/baseclient",editUrl:"https://github.com/rucio/documentation/tree/main/docs/../docs/client_api/baseclient.md",version:"current",frontMatter:{title:"BaseClient"},sidebar:"docs",previous:{title:"AccountLimitClient",permalink:"/documentation/client_api/accountlimitclient"},next:{title:"Client",permalink:"/documentation/client_api/client"}},a=[{value:"choice",id:"choice",children:[]},{value:"__init__",id:"__init__",children:[]},{value:"_get_exception",id:"_get_exception",children:[]},{value:"_load_json_data",id:"_load_json_data",children:[]},{value:"_reduce_data",id:"_reduce_data",children:[]},{value:"_back_off",id:"_back_off",children:[]},{value:"_send_request",id:"_send_request",children:[]},{value:"__get_token_userpass",id:"__get_token_userpass",children:[]},{value:"__refresh_token_OIDC",id:"__refresh_token_oidc",children:[]},{value:"__get_token_OIDC",id:"__get_token_oidc",children:[]},{value:"__get_token_x509",id:"__get_token_x509",children:[]},{value:"__get_token_ssh",id:"__get_token_ssh",children:[]},{value:"__get_token_gss",id:"__get_token_gss",children:[]},{value:"__get_token_saml",id:"__get_token_saml",children:[]},{value:"__get_token",id:"__get_token",children:[]},{value:"__read_token",id:"__read_token",children:[]},{value:"__write_token",id:"__write_token",children:[]},{value:"__authenticate",id:"__authenticate",children:[]}],s={toc:a};function d(e){var t=e.components,n=Object(o.a)(e,l);return Object(b.b)("wrapper",Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(b.b)("h2",{id:"choice"},"choice"),Object(b.b)("p",null,"Select randomly a host"),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"hosts"),": Lost of hosts"))),Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  A randomly selected host."))))),Object(b.b)("h2",{id:"__init__"},"_","_","init","_","_"),Object(b.b)("p",null,"Constructor of the BaseClient."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"rucio_host"),": The address of the rucio server, if None it is read from the config file."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"rucio_port"),": The port of the rucio server, if None it is read from the config file."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"auth_host"),": The address of the rucio authentication server, if None it is read from the config file."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"auth_port"),": The port of the rucio authentication server, if None it is read from the config file."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"account"),": The account to authenticate to rucio."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"use_ssl"),": Enable or disable ssl for commucation. Default is enabled."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"ca_cert"),": The path to the rucio server certificate."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"auth_type"),": The type of authentication (e.g.: 'userpass', 'kerberos' ...)"),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"creds"),": Dictionary with credentials needed for authentication."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"user_agent"),": Indicates the client."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"vo"),": The VO to authenticate into."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"logger"),": Logger object to use. If None, use the default LOG created by the module"))))),Object(b.b)("h2",{id:"_get_exception"},"_","get","_","exception"),Object(b.b)("p",null,"Helper method to parse an error string send by the server and transform it into the corresponding rucio exception."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"headers"),": The http response header containing the Rucio exception details."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"status_code"),": The http status code."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"data"),": The data with the ExceptionMessage."))),Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  A rucio exception class and an error string."))))),Object(b.b)("h2",{id:"_load_json_data"},"_","load","_","json","_","data"),Object(b.b)("p",null,"Helper method to correctly load json data based on the content type of the http response."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"response"),": the response received from the server."))))),Object(b.b)("h2",{id:"_reduce_data"},"_","reduce","_","data"),Object(b.b)("h2",{id:"_back_off"},"_","back","_","off"),Object(b.b)("p",null,"Sleep a certain amount of time which increases with the retry count"),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"retry_number"),": the retry iteration"),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"reason"),": the reason to backoff which will be shown to the user"))))),Object(b.b)("h2",{id:"_send_request"},"_","send","_","request"),Object(b.b)("p",null,"Helper method to send requests to the rucio server. Gets a new token and retries if an unauthorized error is returned."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Arguments"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"url"),": the http url to use."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"headers"),": additional http headers to send."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"type_"),": the http request type to use."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"data"),": post data."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"params"),": (optional) Dictionary or bytes to be sent in the url query string."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"get_token"),": (optional) if it is called from a _get_token function."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"cert"),": (optional) if String, path to the SSL client cert file (.pem). If Tuple, (cert, key) pair."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"auth"),": (optional) auth tuple to enable Basic/Digest/Custom HTTP Auth."),Object(b.b)("p",null,Object(b.b)("inlineCode",{parentName:"p"},"verify"),": (optional) either a boolean, in which case it controls whether we verify the server\u2019s TLS\ncertificate, or a string, in which case it must be a path to a CA bundle to use."))),Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  the HTTP return body."))))),Object(b.b)("h2",{id:"__get_token_userpass"},"_","_","get","_","token","_","userpass"),Object(b.b)("p",null,"Sends a request to get an auth token from the server and stores it as a class attribute. Uses username/password."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__refresh_token_oidc"},"_","_","refresh","_","token","_","OIDC"),Object(b.b)("p",null,"Checks if there is active refresh token and if so returns"),Object(b.b)("p",null,"either active token with expiration timestamp or requests a new\nrefresh and returns new access token with new expiration timestamp\nand saves these in the token directory."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token_oidc"},"_","_","get","_","token","_","OIDC"),Object(b.b)("p",null,"First authenticates the user via a Identity Provider server"),Object(b.b)("p",null,"(with user's username & password), by specifying oidc_scope,\nuser agrees to share the relevant information with Rucio.\nIf all proceeds well, an access token is requested from the Identity Provider.\nAccess Tokens are not stored in Rucio DB.\nRefresh Tokens are granted only in case no valid access token exists in user's\nlocal storage, oidc_scope includes 'offline_access'. In such case, refresh token\nis stored in Rucio DB."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token_x509"},"_","_","get","_","token","_","x509"),Object(b.b)("p",null,"Sends a request to get an auth token from the server and stores it as a class attribute. Uses x509 authentication."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token_ssh"},"_","_","get","_","token","_","ssh"),Object(b.b)("p",null,"Sends a request to get an auth token from the server and stores it as a class attribute. Uses SSH key exchange authentication."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token_gss"},"_","_","get","_","token","_","gss"),Object(b.b)("p",null,"Sends a request to get an auth token from the server and stores it as a class attribute. Uses Kerberos authentication."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token_saml"},"_","_","get","_","token","_","saml"),Object(b.b)("p",null,"Sends a request to get an auth token from the server and stores it as a class attribute. Uses saml authentication."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if the token was successfully received. False otherwise."))))),Object(b.b)("h2",{id:"__get_token"},"_","_","get","_","token"),Object(b.b)("p",null,"Calls the corresponding method to receive an auth token depending on the auth type. To be used if a 401 - Unauthorized error is received."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null)),Object(b.b)("h2",{id:"__read_token"},"_","_","read","_","token"),Object(b.b)("p",null,"Checks if a local token file exists and reads the token from it."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null,Object(b.b)("tr",{style:{border:"none"}},Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Returns"),":")),Object(b.b)("td",{style:{border:"none",backgroundColor:"white",verticalAlign:"top"}},Object(b.b)("p",null,"  True if a token could be read. False if no file exists."))))),Object(b.b)("h2",{id:"__write_token"},"_","_","write","_","token"),Object(b.b)("p",null,"Write the current auth_token to the local token file."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null)),Object(b.b)("h2",{id:"__authenticate"},"_","_","authenticate"),Object(b.b)("p",null,"Main method for authentication. It first tries to read a locally saved token. If not available it requests a new one."),Object(b.b)("table",{style:{border:"none"}},Object(b.b)("tbody",null)))}d.isMDXComponent=!0},412:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return O}));var r=n(0),o=n.n(r);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},b=Object.keys(e);for(r=0;r<b.length;r++)n=b[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(r=0;r<b.length;r++)n=b[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var a=o.a.createContext({}),s=function(e){var t=o.a.useContext(a),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=s(e.components);return o.a.createElement(a.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,b=e.originalType,l=e.parentName,a=i(e,["components","mdxType","originalType","parentName"]),d=s(n),p=r,O=d["".concat(l,".").concat(p)]||d[p]||u[p]||b;return n?o.a.createElement(O,c(c({ref:t},a),{},{components:n})):o.a.createElement(O,c({ref:t},a))}));function O(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var b=n.length,l=new Array(b);l[0]=p;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,l[1]=c;for(var a=2;a<b;a++)l[a]=n[a];return o.a.createElement.apply(null,l)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);